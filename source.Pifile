# Define image URLs in a more maintainable structure
declare -A RASPIOS_IMAGES=(
    ["Raspberry-Pi-5:32-bit"]="https://downloads.raspberrypi.com/raspios_lite_armhf/images/raspios_lite_armhf-2023-12-11/2023-12-11-raspios-bookworm-armhf-lite.img.xz"
    ["Raspberry-Pi-5:64-bit"]="https://downloads.raspberrypi.com/raspios_lite_arm64/images/raspios_lite_arm64-2024-03-15/2024-03-15-raspios-bookworm-arm64-lite.img.xz"
    ["Raspberry-Pi-4:32-bit"]="https://downloads.raspberrypi.org/raspios_lite_armhf/images/raspios_lite_armhf-2021-11-08/2021-10-30-raspios-bullseye-armhf-lite.zip"
    ["Raspberry-Pi-4:64-bit"]="https://downloads.raspberrypi.org/raspios_lite_arm64/images/raspios_lite_arm64-2021-11-08/2021-10-30-raspios-bullseye-arm64-lite.zip"
)

# Create the lookup key from device and architecture
KEY="${DEVICE}:${ARCHITECTURE}"

# Look up the URL directly
URL="${RASPIOS_IMAGES[$KEY]}"

# Validate that we found a valid URL
if [[ -z "${URL}" ]]; then
    echo "Error: No image found for device ${DEVICE} with architecture ${ARCHITECTURE}" >&2
    exit 1
fi

FROM ${URL}